"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[862],{71862:function(e,t,r){r.d(t,{pY:function(){return X},ZP:function(){return ee}});var n,s,a=r(18269),o=r(93338),i=r.n(o);!function(e){e.GET_DATA_LEGACY="getDataLegacy",e.GET_DATA="getData",e.DATA_COUNT="dataCount",e.ALL_DATA="allData",e.OWNER="owner",e.SUPPORTS_INTERFACE="supportsInterface"}(n||(n={})),function(e){e.BYTES="bytes",e.BOOL="bool",e.UINT256="uint256",e.BYTES32_ARRAY="bytes32[]",e.BYTES_ARRAY="bytes[]",e.ADDRESS="address"}(s||(s={}));const c="0x2bd57b73",u="0x5a988c0f";var d;!function(e){e.ERC725="ERC725",e.ERC725_LEGACY="ERC725_LEGACY",e.NOT_ERC725="NOT_ERC725"}(d||(d={}));const l={[n.GET_DATA_LEGACY]:{sig:"0x54f6127f",gas:(0,a.numberToHex)(2e6),gasPrice:(0,a.numberToHex)(1e8),value:(0,a.numberToHex)(0),returnEncoding:s.BYTES},[n.GET_DATA]:{sig:"0x4e3e6e9c",gas:(0,a.numberToHex)(2e6),gasPrice:(0,a.numberToHex)(1e8),value:(0,a.numberToHex)(0),returnEncoding:s.BYTES_ARRAY},[n.DATA_COUNT]:{sig:"0x5da40c47",gas:(0,a.numberToHex)(2e6),gasPrice:(0,a.numberToHex)(1e8),value:(0,a.numberToHex)(0),returnEncoding:s.UINT256},[n.ALL_DATA]:{sig:"0xc559acef",gas:(0,a.numberToHex)(2e6),gasPrice:(0,a.numberToHex)(1e8),value:(0,a.numberToHex)(0),returnEncoding:s.BYTES32_ARRAY},[n.OWNER]:{sig:"0x8da5cb5b",gas:(0,a.numberToHex)(2e6),gasPrice:(0,a.numberToHex)(1e8),value:(0,a.numberToHex)(0),returnEncoding:s.ADDRESS},[n.SUPPORTS_INTERFACE]:{sig:"0x01ffc9a7",gas:(0,a.numberToHex)(2e6),gasPrice:(0,a.numberToHex)(1e8),value:(0,a.numberToHex)(0),returnEncoding:s.BOOL}};var y,f;!function(e){e.KECCAK256_UTF8="keccak256(utf8)",e.KECCAK256_BYTES="keccak256(bytes)"}(y||(y={})),function(e){e.HASH_KECCAK256_UTF8="0x6f357c6a",e.HASH_KECCAK256_BYTES="0x8019f9b1"}(f||(f={}));const p=Object.values(y);const h={method:function(e){return(0,a.keccak256)(JSON.stringify(e))},name:y.KECCAK256_UTF8,sig:f.HASH_KECCAK256_UTF8},g={method:a.keccak256,name:y.KECCAK256_BYTES,sig:f.HASH_KECCAK256_BYTES},b={[y.KECCAK256_UTF8]:h,[f.HASH_KECCAK256_UTF8]:h,[y.KECCAK256_BYTES]:g,[f.HASH_KECCAK256_BYTES]:g},A={CHANGEOWNER:"0x0000000000000000000000000000000000000000000000000000000000000001",CHANGEPERMISSIONS:"0x0000000000000000000000000000000000000000000000000000000000000002",ADDPERMISSIONS:"0x0000000000000000000000000000000000000000000000000000000000000004",SETDATA:"0x0000000000000000000000000000000000000000000000000000000000000008",CALL:"0x0000000000000000000000000000000000000000000000000000000000000010",STATICCALL:"0x0000000000000000000000000000000000000000000000000000000000000020",DELEGATECALL:"0x0000000000000000000000000000000000000000000000000000000000000040",DEPLOY:"0x0000000000000000000000000000000000000000000000000000000000000080",TRANSFERVALUE:"0x0000000000000000000000000000000000000000000000000000000000000100",SIGN:"0x0000000000000000000000000000000000000000000000000000000000000200"};let v=0;const T=i();function m(e,t){const r=t.result;if("0x"===r)return null;const n=T.decodeParameter(l[e].returnEncoding,r);return Array.isArray(n)&&1===n.length&&"0x"===n[0]?[null]:n}function E(e,t,r){const n=r?l[t].sig+r.replace("0x",""):l[t].sig;return v+=1,{jsonrpc:"2.0",method:"eth_call",params:[{to:e,gas:l[t].gas,gasPrice:l[t].gasPrice,value:l[t].value,data:n}],id:v}}var C=function(e,t,r,n){return new(r||(r=Promise))((function(s,a){function o(e){try{c(n.next(e))}catch(t){a(t)}}function i(e){try{c(n.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,i)}c((n=n.apply(e,t||[])).next())}))};const k=i();class S{constructor(e){this.type="WEB3",this.provider=e}getOwner(e){return C(this,void 0,void 0,(function*(){const t=yield this.callContract(E(e,n.OWNER));if(t.error)throw t.error;return m(n.OWNER,t)}))}getErc725YVersion(e){return C(this,void 0,void 0,(function*(){if(yield this.supportsInterface(e,u))return d.ERC725;return(yield this.supportsInterface(e,c))?d.ERC725_LEGACY:d.NOT_ERC725}))}supportsInterface(e,t){return C(this,void 0,void 0,(function*(){return m(n.SUPPORTS_INTERFACE,yield this.callContract(E(e,n.SUPPORTS_INTERFACE,`${t}00000000000000000000000000000000000000000000000000000000`)))}))}getData(e,t){return C(this,void 0,void 0,(function*(){const r=yield this.getAllData(e,[t]);try{return r[0].value}catch(n){return null}}))}getAllData(e,t){return C(this,void 0,void 0,(function*(){const r=yield this.getErc725YVersion(e);if(r===d.NOT_ERC725)throw new Error(`Contract: ${e} does not support ERC725Y interface.`);switch(r){case d.ERC725:return this._getAllData(e,t);case d.ERC725_LEGACY:return this._getAllDataLegacy(e,t);default:return[]}}))}_getAllData(e,t){return C(this,void 0,void 0,(function*(){const r=[E(e,n.GET_DATA,k.encodeParameter("bytes32[]",t))],s=yield this.callContract(r),a=m(n.GET_DATA,s[0]);return t.map(((e,t)=>({key:e,value:a[t]})))}))}_getAllDataLegacy(e,t){return C(this,void 0,void 0,(function*(){const r=[];for(let a=0;a<t.length;a++)r.push(E(e,n.GET_DATA_LEGACY,t[a]));const s=yield this.callContract(r);return r.map(((e,r)=>({key:t[r],value:m(n.GET_DATA_LEGACY,s.find((t=>e.id===t.id)))})))}))}callContract(e){return C(this,void 0,void 0,(function*(){return new Promise(((t,r)=>{this.provider.send(e,((e,n)=>{e?r(e):t(n)}))}))}))}}var x=function(e,t,r,n){return new(r||(r=Promise))((function(s,a){function o(e){try{c(n.next(e))}catch(t){a(t)}}function i(e){try{c(n.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,i)}c((n=n.apply(e,t||[])).next())}))};const P=i();class w{constructor(e){this.type="ETHEREUM",this.provider=e}getOwner(e){return x(this,void 0,void 0,(function*(){const t=this.constructJSONRPC(e,n.OWNER),r=yield this.callContract([t]);if(r.error)throw r.error;return this.decodeResult(n.OWNER,r)}))}getErc725YVersion(e){return x(this,void 0,void 0,(function*(){if(yield this.supportsInterface(e,u))return d.ERC725;return(yield this.supportsInterface(e,c))?d.ERC725_LEGACY:d.NOT_ERC725}))}supportsInterface(e,t){return x(this,void 0,void 0,(function*(){return this.decodeResult(n.SUPPORTS_INTERFACE,yield this.callContract([this.constructJSONRPC(e,n.SUPPORTS_INTERFACE,`${t}00000000000000000000000000000000000000000000000000000000`)]))}))}getData(e,t){return x(this,void 0,void 0,(function*(){const r=this.getAllData(e,[t]);try{return r[0].value}catch(n){return null}}))}getAllData(e,t){return x(this,void 0,void 0,(function*(){const r=yield this.getErc725YVersion(e);if(r===d.NOT_ERC725)throw new Error(`Contract: ${e} does not support ERC725Y interface.`);switch(r){case d.ERC725:return this._getAllData(e,t);case d.ERC725_LEGACY:return this._getAllDataLegacy(e,t);default:return[]}}))}_getAllData(e,t){return x(this,void 0,void 0,(function*(){const r=yield this.callContract([this.constructJSONRPC(e,n.GET_DATA,P.encodeParameter("bytes32[]",t))]),s=this.decodeResult(n.GET_DATA,r);return t.map(((e,t)=>({key:e,value:s[t]})))}))}_getAllDataLegacy(e,t){return x(this,void 0,void 0,(function*(){const r=t.map((t=>this.callContract([this.constructJSONRPC(e,n.GET_DATA_LEGACY,t)])));return(yield Promise.all(r)).map(((e,r)=>({key:t[r],value:this.decodeResult(n.GET_DATA_LEGACY,e)})))}))}constructJSONRPC(e,t,r){const n=r?l[t].sig+r.replace("0x",""):l[t].sig;return{to:e,gas:l[t].gas,gasPrice:l[t].gasPrice,value:l[t].value,data:n}}callContract(e){return x(this,void 0,void 0,(function*(){return this.provider.request({method:"eth_call",params:e})}))}decodeResult(e,t){return m(e,{result:t})}}const R=(e,t,r)=>{const n=j(e);return(0,a.keccak256)(n.name).substr(0,10)+t.substr(2)+(0,a.utf8ToHex)(r).substr(2)},_=i(),O=e=>{const t=j(e.substr(0,10)),r=e.replace("0x","").substr(8),n="0x"+r.substr(0,64),s=(0,a.hexToUtf8)("0x"+r.substr(64));return{hashFunction:t.name,hash:n,url:s}},L={string:{encode:e=>_.encodeParameter("string",e),decode:e=>_.decodeParameter("string",e)},address:{encode:e=>_.encodeParameter("address",e),decode:e=>_.decodeParameter("address",e)},uint256:{encode:e=>_.encodeParameter("uint256",e),decode:e=>_.decodeParameter("uint256",e)},bytes32:{encode:e=>_.encodeParameter("bytes32",e),decode:e=>_.decodeParameter("bytes32",e)},bytes4:{encode:e=>_.encodeParameter("bytes4",e),decode:e=>_.decodeParameter("bytes4",e)},bytes:{encode:e=>_.encodeParameter("bytes",e),decode:e=>_.decodeParameter("bytes",e)},"string[]":{encode:e=>_.encodeParameter("string[]",e),decode:e=>_.decodeParameter("string[]",e)},"address[]":{encode:e=>_.encodeParameter("address[]",e),decode:e=>_.decodeParameter("address[]",e)},"uint256[]":{encode:e=>_.encodeParameter("uint256[]",e),decode:e=>_.decodeParameter("uint256[]",e)},"bytes32[]":{encode:e=>_.encodeParameter("bytes32[]",e),decode:e=>_.decodeParameter("bytes32[]",e)},"bytes4[]":{encode:e=>_.encodeParameter("bytes4[]",e),decode:e=>_.decodeParameter("bytes4[]",e)},"bytes[]":{encode:e=>_.encodeParameter("bytes[]",e),decode:e=>_.decodeParameter("bytes[]",e)}},N={Keccak256:{type:"bytes32",encode:e=>e,decode:e=>e},ArrayLength:{type:"uint256",encode:e=>(0,a.padLeft)((0,a.numberToHex)(e),64),decode:e=>(0,a.hexToNumber)(e)},Number:{type:"uint256",encode:e=>{let t;try{t=parseInt(e,10)}catch(r){throw new Error(r)}return(0,a.padLeft)((0,a.numberToHex)(t),64)},decode:e=>""+(0,a.hexToNumber)(e)},Address:{type:"address",encode:e=>{if((0,a.isAddress)(e))return e.toLowerCase();throw new Error('Address: "'+e+'" is an invalid address.')},decode:e=>(0,a.toChecksumAddress)(e)},String:{type:"string",encode:e=>(0,a.utf8ToHex)(e),decode:e=>(0,a.hexToUtf8)(e)},Markdown:{type:"string",encode:e=>(0,a.utf8ToHex)(e),decode:e=>(0,a.hexToUtf8)(e)},URL:{type:"string",encode:e=>(0,a.utf8ToHex)(e),decode:e=>(0,a.hexToUtf8)(e)},AssetURL:{type:"custom",encode:e=>R(e.hashFunction,e.hash,e.url),decode:e=>O(e)},JSONURL:{type:"custom",encode:e=>{const{hash:t,json:r,hashFunction:n,url:s}=e;let a=t;if(r){if(n)throw new Error('When passing in the `json` property, we use "keccak256(utf8)" as a default hashingFunction. You do not need to set a `hashFunction`.');a=W(r,y.KECCAK256_UTF8)}if(!a)throw new Error("You have to provide either the hash or the json via the respective properties");return R(n||y.KECCAK256_UTF8,a,s)},decode:e=>O(e)}};function D(e,t){if(!L[e])throw new Error('Could not encode valueType: "'+e+'".');return t?L[e].encode(t):t}function G(e,t){if(!N[e]&&"0x"!==e.substr(0,2))throw new Error('Could not encode valueContent: "'+e+'".');return"0x"===e.substr(0,2)?e===t&&t:t?N[e].encode(t):"0x"}function H(e,t){if(!N[e]&&"0x"!==e.substr(0,2))throw new Error('Could not decode valueContent: "'+e+'".');return"0x"===e.substr(0,2)?e===t&&t:t?N[e].decode(t):t}function M(e,t,r,n){if(!(N[e]||"0x"===e.substr(0,2)))throw new Error(`The valueContent '${e}' \n            for ${n} is not supported.`);let s;const a=N[e]&&N[e].type===t.split("[]")[0],o="[]"===t.substr(t.length-2);if(Array.isArray(r)&&!a){const t=[];for(let n=0;n<r.length;n++){const s=r[n];t.push(G(e,s))}s=t}else o||Array.isArray(r)?a&&(s=r):s=G(e,r);return"bytes"===t||a?o&&a&&(s=D(t,s)):s=D(t,s),s}function I(e,t){return e.substr(0,34)+(0,a.padLeft)((0,a.numberToHex)(t),32).replace("0x","")}function Y(e,t){const r="0x"===t.substr(0,2)?t:function(e){switch(function(e){const t=e.split(":");return 3===t.length?"Bytes20MappingWithGrouping":2===t.length?"0x"===t[1].substr(0,2)?"Bytes20Mapping":"Mapping":"[]"===e.substring(e.length-2,e.length)?"Array":"Singleton"}(e)){case"Bytes20MappingWithGrouping":{const t=e.split(":");return(0,a.keccak256)(t[0]).substr(0,10)+"00000000"+(0,a.keccak256)(t[1]).substr(2,4)+"0000"+t[2].substr(0,40)}case"Bytes20Mapping":{const t=e.split(":");return(0,a.keccak256)(t[0]).substr(0,18)+"00000000"+t[1].substr(2,40)}case"Mapping":{const t=e.split(":");return(0,a.keccak256)(t[0]).substr(0,34)+"000000000000000000000000"+(0,a.keccak256)(t[1]).substr(2,8)}case"Array":case"Singleton":default:return(0,a.keccak256)(e)}}(t),n=e.find((e=>e.key===r));if(!n)throw new Error('No matching schema found for key: "'+t+'" ('+r+").");return n}function U(e,t){switch(e.keyType.toLowerCase()){case"array":{if(!Array.isArray(t))return console.error("Can't encode a non array for key of type array"),null;const r=[];for(let n=0;n<t.length;n++){const s=t[n];0===n&&r.push({key:e.key,value:M("Number","uint256",t.length.toString(),e.name)}),r.push({key:I(e.key,n),value:M(e.valueContent,e.valueType,s,e.name)})}return r}case"bytes20mapping":case"bytes20mappingwithgrouping":case"singleton":case"mapping":return M(e.valueContent,e.valueType,t,e.name);default:return console.error('Incorrect data match or keyType in schema from encodeKey(): "'+e.keyType+'"'),null}}function B(e,t,r,n){if(!N[e]&&"0x"!==e.substr(0,2))throw new Error('The valueContent "'+e+'" for "'+n+'" is not supported.');let s=N[e]&&N[e].type===t.split("[]")[0];const o="[]"===t.substr(t.length-2);if("bytes"===t||"string"===t||(0,a.isAddress)(r)||(r=function(e,t){if(!L[e])throw new Error('Could not decode valueType: "'+e+'".');return"0x"===t?null:t?L[e].decode(t):t}(t,r)),s&&(0,a.isAddress)(r)&&!(0,a.checkAddressChecksum)(r)&&(s=!s),s&&"string"!==t)return r;if(o&&Array.isArray(r)){const t=[];for(let n=0;n<r.length;n++){const s=r[n];t.push(H(e,s))}return t}return H(e,r)}function K(e,t){switch(e.keyType.toLowerCase()){case"array":{const r=[];if(!t||"string"===typeof t)return r;const n=t.find((t=>t.key===e.key));if(!n)return r;const s=B("Number","uint256",n.value,e.name)||0;for(let a=0;a<s;a++){const n=t.find((t=>t.key===I(e.key,a)));n&&r.push(B(e.valueContent,e.valueType,n.value,e.name))}return r}case"bytes20mapping":case"bytes20mappingwithgrouping":case"singleton":case"mapping":if(Array.isArray(t)){const r=t.find((t=>t.key===e.key));return r?B(e.valueContent,e.valueType,r.value,e.name):null}return B(e.valueContent,e.valueType,t,e.name);default:return console.error('Incorrect data match or keyType in schema from decodeKey(): "'+e.keyType+'"'),null}}function F(e,t){return Object.entries(e).reduce(((e,[r,n])=>{const s=Y(t,r);return Object.assign(Object.assign({},e),{[s.name]:K(s,n)})}),{})}function j(e){const t=b[e];if(!t)throw new Error(`Chosen hashFunction '${e}' is not supported.\n      Supported hashFunctions: ${p}\n      `);return t}function W(e,t){return j(t).method(e)}var $=JSON.parse('[{"name":"SupportedStandards:LSP3UniversalProfile","key":"0xeafec4d89fa9619884b6b89135626455000000000000000000000000abe425d6","keyType":"Mapping","valueContent":"0xabe425d6","valueType":"bytes"},{"name":"LSP3Profile","key":"0x5ef83ad9559033e6e941db7d7c495acdce616347d28e90c7ce47cbfcfcad3bc5","keyType":"Singleton","valueContent":"JSONURL","valueType":"bytes"},{"name":"LSP3IssuedAssetsMap:<address>","key":"0x83f5e77bfb14241600000000<address>","keyType":"Mapping","valueContent":"Mixed","valueType":"bytes"},{"name":"LSP3IssuedAssets[]","key":"0x3a47ab5bd3a594c3a8995f8fa58d0876c96819ca4516bd76100c92462f2f9dc0","keyType":"Array","valueContent":"Address","valueType":"address"},{"name":"LSP5ReceivedAssetsMap:<address>","key":"0x812c4334633eb81600000000<address>","keyType":"Mapping","valueContent":"Mixed","valueType":"bytes"},{"name":"LSP5ReceivedAssets[]","key":"0x6460ee3c0aac563ccbf76d6e1d07bada78e3a9514e6382b736ed3f478ab7b90b","keyType":"Array","valueContent":"Address","valueType":"address"},{"name":"LSP1UniversalReceiverDelegate","key":"0x0cfc51aec37c55a4d0b1a65c6255c4bf2fbdf6277f3cc0730c45b828b6db8b47","keyType":"Singleton","valueContent":"Address","valueType":"address"}]'),J=JSON.parse('[{"name":"SupportedStandards:LSP4DigitalAsset","key":"0xeafec4d89fa9619884b6b89135626455000000000000000000000000a4d96624","keyType":"Mapping","valueContent":"0xa4d96624","valueType":"bytes"},{"name":"LSP4TokenName","key":"0xdeba1e292f8ba88238e10ab3c7f88bd4be4fac56cad5194b6ecceaf653468af1","keyType":"Singleton","valueContent":"String","valueType":"string"},{"name":"LSP4TokenSymbol","key":"0x2f0a68ab07768e01943a599e73362a0e17a63a72e94dd2e384d2c1d4db932756","keyType":"Singleton","valueContent":"String","valueType":"string"},{"name":"LSP4Metadata","key":"0x9afb95cacc9f95858ec44aa8c3b685511002e30ae54415823f406128b85b238e","keyType":"Singleton","valueContent":"JSONURL","valueType":"bytes"},{"name":"LSP4Creators[]","key":"0x114bd03b3a46d48759680d81ebb2b414fda7d030a7105a851867accf1c2352e7","keyType":"Array","valueContent":"Number","valueType":"uint256","elementValueContent":"Address","elementValueType":"address"}]'),V=JSON.parse('[{"name":"LSP5ReceivedAssetsMap:<address>","key":"0x812c4334633eb81600000000<address>","keyType":"Mapping","valueContent":"Mixed","valueType":"bytes"},{"name":"LSP5ReceivedAssets[]","key":"0x6460ee3c0aac563ccbf76d6e1d07bada78e3a9514e6382b736ed3f478ab7b90b","keyType":"Array","valueContent":"Address","valueType":"address"}]'),q=JSON.parse('[{"name":"AddressPermissions[]","key":"0xdf30dba06db6a30e65354d9a64c609861f089545ca58c6b4dbe31a5f338cb0e3","keyType":"Array","valueContent":"Address","valueType":"address"},{"name":"AddressPermissions:Permissions:<address>","key":"0x4b80742d0000000082ac0000<address>","keyType":"Bytes20MappingWithGrouping","valueContent":"BitArray","valueType":"byte32"},{"name":"AddressPermissions:AllowedAddresses:<address>","key":"0x4b80742d00000000c6dd0000<address>","keyType":"Bytes20MappingWithGrouping","valueContent":"Address","valueType":"address[]"},{"name":"AddressPermissions:AllowedFunctions:<address>","key":"0x4b80742d000000008efe0000<address>","keyType":"Bytes20MappingWithGrouping","valueContent":"Bytes4","valueType":"bytes4[]"},{"name":"AddressPermissions:AllowedStandards:<address>","key":"0x4b80742d000000003efa0000<address>","keyType":"Bytes20MappingWithGrouping","valueContent":"Bytes4","valueType":"bytes4[]"}]'),z=$.concat(J,V,q);function Z(e,t){const r=(e=>({Singleton:e.filter((e=>"Singleton"===e.keyType)),Array:e.filter((e=>"Array"===e.keyType)),Mapping:e.filter((e=>"Mapping"===e.keyType)),Bytes20Mapping:e.filter((e=>"Bytes20Mapping"===e.keyType)),Bytes20MappingWithGrouping:e.filter((e=>"Bytes20MappingWithGrouping"===e.keyType))}))(t);let n=null;return n=((e,t)=>t.find((t=>t.key===e))||null)(e,r.Singleton),n||(n=((e,t)=>{const r=t.find((t=>t.key===e))||null;if(r)return r;const n=e.substr(0,34),s=t.find((e=>e.key.substr(0,34)===n))||null;if(!s)return null;const a=parseInt(e.substr(34),10);return a?Object.assign(Object.assign({},s),{name:s.name.replace("[]",`[${a}]`),keyType:"Singleton"}):null})(e,r.Array),n||(n=((e,t)=>{let r=t.find((t=>t.key===e))||null;return r||(r=t.find((t=>t.key.substr(0,58)===e.substr(0,58)))||null,r?Object.assign(Object.assign({},r),{name:`${r.name.split(":")[0]}:??????`,key:e}):null)})(e,r.Mapping),n||(n=((e,t)=>{const r=t.find((t=>t.key.substr(0,26)===e.substr(0,26)))||null,n=e.substr(26);return r?Object.assign(Object.assign({},r),{key:e,name:`${r.name.substr(0,r.name.lastIndexOf(":"))}:${n}`}):null})(e,r.Bytes20Mapping),n||(n=((e,t)=>{const r=t.find((t=>t.key.substr(0,26)===e.substr(0,26)))||null,n=e.substr(26);return r?Object.assign(Object.assign({},r),{key:e,name:`${r.name.substr(0,r.name.lastIndexOf(":"))}:${n}`}):null})(e,r.Bytes20MappingWithGrouping),n))))}var Q=function(e,t,r,n){return new(r||(r=Promise))((function(s,a){function o(e){try{c(n.next(e))}catch(t){a(t)}}function i(e){try{c(n.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,i)}c((n=n.apply(e,t||[])).next())}))};class X{constructor(e,t,r,n){if(!e)throw new Error("Missing schema.");this.options={schema:e,address:t,provider:this.initializeProvider(r),config:Object.assign(Object.assign({},{ipfsGateway:"https://cloudflare-ipfs.com/ipfs/"}),n)}}initializeProvider(e){if(e){if("function"===typeof e.request)return new w(e);if(!e.request&&"function"===typeof e.send)return new S(e);throw new Error(`Incorrect or unsupported provider ${e}`)}}getData(e){return Q(this,void 0,void 0,(function*(){return this.getAddressAndProvider(),e||(e=this.options.schema.map((e=>e.name))),Array.isArray(e)?this.getDataMultiple(e):this.getDataSingle(e)}))}fetchData(e){return Q(this,void 0,void 0,(function*(){const t=yield this.getData(e),r=yield this.getDataFromExternalSources(t);return Object.assign(Object.assign({},t),r)}))}getSchema(e,t){return function(e,t){let r=z;return t&&(r=r.concat(t)),Array.isArray(e)?e.reduce(((e,t)=>(e[t]=Z(t,r),e)),{}):Z(e,r)}(e,this.options.schema.concat(t||[]))}getDataFromExternalSources(e){return Object.entries(e).filter((([e])=>{const t=Y(this.options.schema,e);return["jsonurl","asseturl"].includes(t.valueContent.toLowerCase())})).reduce(((e,[t,r])=>Q(this,void 0,void 0,(function*(){if(!r)return e[t]=null,e;let n;try{const{url:e}=this.patchIPFSUrlsIfApplicable(r);n=yield fetch(e).then((e=>Q(this,void 0,void 0,(function*(){return r.hashFunction===y.KECCAK256_BYTES?e.arrayBuffer().then((e=>new Uint8Array(e))):e.json()}))))}catch(s){throw console.error(s,`GET request to ${r.url} failed`),s}return e[t]=function(e,t,r){const n=W(e,r);return n===t||(console.error(`Hash mismatch, returned JSON hash ("${n}") is different from expected hash "${t}"`),!1)}(n,r.hash,r.hashFunction)?n:null,e}))),{})}encodeData(e){return function(e,t){return Object.entries(e).reduce(((e,[r,n])=>{const s=Y(t,r);return e[r]={value:U(s,n),key:s.key},e}),{})}(e,this.options.schema)}decodeData(e){return F(e,this.options.schema)}getOwner(e){return Q(this,void 0,void 0,(function*(){const{address:t,provider:r}=this.getAddressAndProvider();return r.getOwner(e||t)}))}getArrayValues(e,t){var r;return Q(this,void 0,void 0,(function*(){if("Array"!==e.keyType)throw new Error(`The "getArrayValues" method requires a schema definition with "keyType: Array",\n         ${e}`);const n=[],s=t[e.key];if(!s||!s.value)return n;const a=yield B("Number","uint256",s.value,e.name),o=[];for(let r=0;r<a;r++){const n=I(e.key,r);t[n]||o.push(n)}try{const e=yield null===(r=this.options.provider)||void 0===r?void 0:r.getAllData(this.options.address,o);n.push(...e)}catch(i){}return n}))}getDataSingle(e){var t;return Q(this,void 0,void 0,(function*(){const r=Y(this.options.schema,e),n=yield null===(t=this.options.provider)||void 0===t?void 0:t.getData(this.options.address,r.key);if("array"===r.keyType.toLowerCase()){const e={[r.key]:{key:r.key,value:n}},t=yield this.getArrayValues(r,e);return t&&t.length>0?(t.push(e[r.key]),{[r.name]:K(r,t)}):{[r.name]:[]}}return{[r.name]:K(r,n)}}))}getDataMultiple(e){var t;return Q(this,void 0,void 0,(function*(){const r=e.map((e=>Y(this.options.schema,e).key)),n=(yield null===(t=this.options.provider)||void 0===t?void 0:t.getAllData(this.options.address,r)).reduce(((e,t)=>(e[t.key]=t.value,e)),{}),s=this.options.schema.filter((e=>"array"===e.keyType.toLowerCase()));for(const e of s){const t={[e.key]:{key:e.key,value:n[e.key]}},r=yield this.getArrayValues(e,t);r&&r.length>0&&(r.push(t[e.key]),n[e.key]=r)}return F(n,this.options.schema)}))}patchIPFSUrlsIfApplicable(e){return e&&e.url&&-1!==e.url.indexOf("ipfs://")?Object.assign(Object.assign({},e),{url:e.url.replace("ipfs://",this.options.config.ipfsGateway)}):e}getAddressAndProvider(){if(!(0,a.isAddress)(this.options.address))throw new Error("Missing ERC725 contract address.");if(!this.options.provider)throw new Error("Missing provider.");return{address:this.options.address,provider:this.options.provider}}static encodePermissions(e){const t=Object.keys(e).reduce(((t,r)=>e[r]?t+(0,a.hexToNumber)(A[r]):t),0);return(0,a.leftPad)((0,a.toHex)(t),64)}static decodePermissions(e){const t={CHANGEOWNER:!1,CHANGEPERMISSIONS:!1,ADDPERMISSIONS:!1,SETDATA:!1,CALL:!1,STATICCALL:!1,DELEGATECALL:!1,DEPLOY:!1,TRANSFERVALUE:!1,SIGN:!1},r=Object.keys(A);if("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"===e)return r.forEach((e=>{t[e]=!0})),t;const n=(0,a.hexToNumber)(e);return r.forEach((e=>{const r=(0,a.hexToNumber)(A[e]),s=(n&r)===r;t[e]=s})),t}static encodeKeyName(e){if(e.includes(":")){const t=e.split(":"),r=(0,a.isAddress)(t[t.length-1]),n=3===t.length;if(!r&&!n)return(0,a.keccak256)(t[0]).slice(0,34)+"0".repeat(24)+(0,a.keccak256)(t[1]).slice(2).slice(0,8);if(r&&!n)return(0,a.keccak256)(t[0]).slice(0,18)+"0".repeat(8)+t[t.length-1];if(r&&n)return(0,a.keccak256)(t[0]).slice(0,10)+"0".repeat(8)+(0,a.keccak256)(t[1]).slice(2).slice(0,4)+"0".repeat(4)+t[t.length-1]}return(0,a.keccak256)(e)}}var ee=X}}]);