"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[945],{78945:function(e,t,r){r.d(t,{pY:function(){return V}});var n,o,s=r(18269),i=r(93338),a=r.n(i);!function(e){e.GET_DATA_LEGACY="getDataLegacy",e.GET_DATA="getData",e.DATA_COUNT="dataCount",e.ALL_DATA="allData",e.OWNER="owner",e.SUPPORTS_INTERFACE="supportsInterface"}(n||(n={})),function(e){e.BYTES="bytes",e.BOOL="bool",e.UINT256="uint256",e.BYTES32_ARRAY="bytes32[]",e.BYTES_ARRAY="bytes[]",e.ADDRESS="address"}(o||(o={}));const c="0x2bd57b73",u="0x5a988c0f";var d;!function(e){e.ERC725="ERC725",e.ERC725_LEGACY="ERC725_LEGACY",e.NOT_ERC725="NOT_ERC725"}(d||(d={}));const l={[n.GET_DATA_LEGACY]:{sig:"0x54f6127f",gas:(0,s.numberToHex)(2e6),gasPrice:(0,s.numberToHex)(1e8),value:(0,s.numberToHex)(0),returnEncoding:o.BYTES},[n.GET_DATA]:{sig:"0x4e3e6e9c",gas:(0,s.numberToHex)(2e6),gasPrice:(0,s.numberToHex)(1e8),value:(0,s.numberToHex)(0),returnEncoding:o.BYTES_ARRAY},[n.DATA_COUNT]:{sig:"0x5da40c47",gas:(0,s.numberToHex)(2e6),gasPrice:(0,s.numberToHex)(1e8),value:(0,s.numberToHex)(0),returnEncoding:o.UINT256},[n.ALL_DATA]:{sig:"0xc559acef",gas:(0,s.numberToHex)(2e6),gasPrice:(0,s.numberToHex)(1e8),value:(0,s.numberToHex)(0),returnEncoding:o.BYTES32_ARRAY},[n.OWNER]:{sig:"0x8da5cb5b",gas:(0,s.numberToHex)(2e6),gasPrice:(0,s.numberToHex)(1e8),value:(0,s.numberToHex)(0),returnEncoding:o.ADDRESS},[n.SUPPORTS_INTERFACE]:{sig:"0x01ffc9a7",gas:(0,s.numberToHex)(2e6),gasPrice:(0,s.numberToHex)(1e8),value:(0,s.numberToHex)(0),returnEncoding:o.BOOL}};var h,p;!function(e){e.KECCAK256_UTF8="keccak256(utf8)",e.KECCAK256_BYTES="keccak256(bytes)"}(h||(h={})),function(e){e.HASH_KECCAK256_UTF8="0x6f357c6a",e.HASH_KECCAK256_BYTES="0x8019f9b1"}(p||(p={}));const f=Object.values(h);const y={method:function(e){return(0,s.keccak256)(JSON.stringify(e))},name:h.KECCAK256_UTF8,sig:p.HASH_KECCAK256_UTF8},g={method:s.keccak256,name:h.KECCAK256_BYTES,sig:p.HASH_KECCAK256_BYTES},E={[h.KECCAK256_UTF8]:y,[p.HASH_KECCAK256_UTF8]:y,[h.KECCAK256_BYTES]:g,[p.HASH_KECCAK256_BYTES]:g};let v=0;const A=a();function T(e,t){const r=t.result;if("0x"===r)return null;const n=A.decodeParameter(l[e].returnEncoding,r);return Array.isArray(n)&&1===n.length&&"0x"===n[0]?[null]:n}function m(e,t,r){const n=r?l[t].sig+r.replace("0x",""):l[t].sig;return v+=1,{jsonrpc:"2.0",method:"eth_call",params:[{to:e,gas:l[t].gas,gasPrice:l[t].gasPrice,value:l[t].value,data:n}],id:v}}var C=function(e,t,r,n){return new(r||(r=Promise))((function(o,s){function i(e){try{c(n.next(e))}catch(t){s(t)}}function a(e){try{c(n.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}c((n=n.apply(e,t||[])).next())}))};const b=a();class w{constructor(e){this.type="WEB3",this.provider=e}getOwner(e){return C(this,void 0,void 0,(function*(){const t=yield this.callContract(m(e,n.OWNER));if(t.error)throw t.error;return T(n.OWNER,t)}))}getErc725YVersion(e){return C(this,void 0,void 0,(function*(){if(yield this.supportsInterface(e,u))return d.ERC725;return(yield this.supportsInterface(e,c))?d.ERC725_LEGACY:d.NOT_ERC725}))}supportsInterface(e,t){return C(this,void 0,void 0,(function*(){return T(n.SUPPORTS_INTERFACE,yield this.callContract(m(e,n.SUPPORTS_INTERFACE,`${t}00000000000000000000000000000000000000000000000000000000`)))}))}getData(e,t){return C(this,void 0,void 0,(function*(){switch(yield this.getErc725YVersion(e)){case"ERC725":return T(n.GET_DATA,yield this.callContract(m(e,n.GET_DATA,b.encodeParameter("bytes32[]",[t]))))[0];case"ERC725_LEGACY":return T(n.GET_DATA_LEGACY,yield this.callContract(m(e,n.GET_DATA_LEGACY,t)));default:throw new Error(`Contract: ${e} does not support ERC725Y interface.`)}}))}getAllData(e,t){return C(this,void 0,void 0,(function*(){const r=yield this.getErc725YVersion(e);if("NOT_ERC725"===r)throw new Error(`Contract: ${e} does not support ERC725Y interface.`);const o="ERC725"===r?n.GET_DATA:n.GET_DATA_LEGACY,s=[];for(let n=0;n<t.length;n++)s.push(m(e,o,"ERC725"===r?b.encodeParameter("bytes32[]",[t[n]]):t[n]));const i=yield this.callContract(s),a=[];for(let e=0;e<s.length;e++){const n=T(o,i.find((t=>s[e].id===t.id)));a.push({key:t[e],value:"ERC725"===r?n[0]:n})}return a}))}callContract(e){return C(this,void 0,void 0,(function*(){return new Promise(((t,r)=>{this.provider.send(e,((e,n)=>{e?r(e):t(n)}))}))}))}}var k=function(e,t,r,n){return new(r||(r=Promise))((function(o,s){function i(e){try{c(n.next(e))}catch(t){s(t)}}function a(e){try{c(n.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}c((n=n.apply(e,t||[])).next())}))};const _=a();class x{constructor(e){this.type="ETHEREUM",this.provider=e}getOwner(e){return k(this,void 0,void 0,(function*(){const t=this.constructJSONRPC(e,n.OWNER),r=yield this.callContract([t]);if(r.error)throw r.error;return this.decodeResult(n.OWNER,r)}))}getErc725YVersion(e){return k(this,void 0,void 0,(function*(){if(yield this.supportsInterface(e,u))return d.ERC725;return(yield this.supportsInterface(e,c))?d.ERC725_LEGACY:d.NOT_ERC725}))}supportsInterface(e,t){return k(this,void 0,void 0,(function*(){return this.decodeResult(n.SUPPORTS_INTERFACE,yield this.callContract([this.constructJSONRPC(e,n.SUPPORTS_INTERFACE,`${t}00000000000000000000000000000000000000000000000000000000`)]))}))}getData(e,t,r){return k(this,void 0,void 0,(function*(){switch(null!==r&&void 0!==r?r:yield this.getErc725YVersion(e)){case"ERC725":return this.decodeResult(n.GET_DATA,yield this.callContract([this.constructJSONRPC(e,n.GET_DATA,_.encodeParameter("bytes32[]",[t]))]))[0];case"ERC725_LEGACY":return this.decodeResult(n.GET_DATA_LEGACY,yield this.callContract([this.constructJSONRPC(e,n.GET_DATA_LEGACY,t)]));default:throw new Error(`Contract: ${e} does not support ERC725Y interface.`)}}))}getAllData(e,t){return k(this,void 0,void 0,(function*(){const r=[],n=yield this.getErc725YVersion(e);for(let o=0;o<t.length;o++){const s=yield this.getData(e,t[o],n);r.push({key:t[o],value:s})}return r}))}constructJSONRPC(e,t,r){const n=r?l[t].sig+r.replace("0x",""):l[t].sig;return{to:e,gas:l[t].gas,gasPrice:l[t].gasPrice,value:l[t].value,data:n}}callContract(e){return k(this,void 0,void 0,(function*(){return this.provider.request({method:"eth_call",params:e})}))}decodeResult(e,t){return T(e,{result:t})}}const P=(e,t,r)=>{const n=j(e);return(0,s.keccak256)(n.name).substr(0,10)+t.substr(2)+(0,s.utf8ToHex)(r).substr(2)},R=a(),S=e=>{const t=j(e.substr(0,10)),r=e.replace("0x","").substr(8),n="0x"+r.substr(0,64),o=(0,s.hexToUtf8)("0x"+r.substr(64));return{hashFunction:t.name,hash:n,url:o}},O={string:{encode:e=>R.encodeParameter("string",e),decode:e=>R.decodeParameter("string",e)},address:{encode:e=>R.encodeParameter("address",e),decode:e=>R.decodeParameter("address",e)},uint256:{encode:e=>R.encodeParameter("uint256",e),decode:e=>R.decodeParameter("uint256",e)},bytes32:{encode:e=>R.encodeParameter("bytes32",e),decode:e=>R.decodeParameter("bytes32",e)},bytes4:{encode:e=>R.encodeParameter("bytes4",e),decode:e=>R.decodeParameter("bytes4",e)},bytes:{encode:e=>R.encodeParameter("bytes",e),decode:e=>R.decodeParameter("bytes",e)},"string[]":{encode:e=>R.encodeParameter("string[]",e),decode:e=>R.decodeParameter("string[]",e)},"address[]":{encode:e=>R.encodeParameter("address[]",e),decode:e=>R.decodeParameter("address[]",e)},"uint256[]":{encode:e=>R.encodeParameter("uint256[]",e),decode:e=>R.decodeParameter("uint256[]",e)},"bytes32[]":{encode:e=>R.encodeParameter("bytes32[]",e),decode:e=>R.decodeParameter("bytes32[]",e)},"bytes4[]":{encode:e=>R.encodeParameter("bytes4[]",e),decode:e=>R.decodeParameter("bytes4[]",e)},"bytes[]":{encode:e=>R.encodeParameter("bytes[]",e),decode:e=>R.decodeParameter("bytes[]",e)}},D={Keccak256:{type:"bytes32",encode:e=>e,decode:e=>e},ArrayLength:{type:"uint256",encode:e=>(0,s.padLeft)((0,s.numberToHex)(e),64),decode:e=>(0,s.hexToNumber)(e)},Number:{type:"uint256",encode:e=>{let t;try{t=parseInt(e,10)}catch(r){throw new Error(r)}return(0,s.padLeft)((0,s.numberToHex)(t),64)},decode:e=>""+(0,s.hexToNumber)(e)},Address:{type:"address",encode:e=>{if((0,s.isAddress)(e))return e.toLowerCase();throw new Error('Address: "'+e+'" is an invalid address.')},decode:e=>(0,s.toChecksumAddress)(e)},String:{type:"string",encode:e=>(0,s.utf8ToHex)(e),decode:e=>(0,s.hexToUtf8)(e)},Markdown:{type:"string",encode:e=>(0,s.utf8ToHex)(e),decode:e=>(0,s.hexToUtf8)(e)},URL:{type:"string",encode:e=>(0,s.utf8ToHex)(e),decode:e=>(0,s.hexToUtf8)(e)},AssetURL:{type:"custom",encode:e=>P(e.hashFunction,e.hash,e.url),decode:e=>S(e)},JSONURL:{type:"custom",encode:e=>{const{hash:t,json:r,hashFunction:n,url:o}=e;let s=t;if(r){if(n)throw new Error('When passing in the `json` property, we use "keccak256(utf8)" as a default hashingFunction. You do not need to set a `hashFunction`.');s=$(r,h.KECCAK256_UTF8)}if(!s)throw new Error("You have to provide either the hash or the json via the respective properties");return P(n||h.KECCAK256_UTF8,s,o)},decode:e=>S(e)}};function H(e,t){if(!O[e])throw new Error('Could not encode valueType: "'+e+'".');return t?O[e].encode(t):t}function Y(e,t){if(!D[e]&&"0x"!==e.substr(0,2))throw new Error('Could not encode valueContent: "'+e+'".');return"0x"===e.substr(0,2)?e===t&&t:t?D[e].encode(t):"0x"}function N(e,t){if(!D[e]&&"0x"!==e.substr(0,2))throw new Error('Could not decode valueContent: "'+e+'".');return"0x"===e.substr(0,2)?e===t&&t:t?D[e].decode(t):t}function L(e,t,r,n){if(!(D[e]||"0x"===e.substr(0,2)))throw new Error(`The valueContent '${e}' \n            for ${n} is not supported.`);let o;const s=D[e]&&D[e].type===t.split("[]")[0],i="[]"===t.substr(t.length-2);if(Array.isArray(r)&&!s){const t=[];for(let n=0;n<r.length;n++){const o=r[n];t.push(Y(e,o))}o=t}else i||Array.isArray(r)?s&&(o=r):o=Y(e,r);return"bytes"===t||s?i&&s&&(o=H(t,o)):o=H(t,o),o}function G(e,t){return e.substr(0,34)+(0,s.padLeft)((0,s.numberToHex)(t),32).replace("0x","")}function K(e,t){const r="0x"===t.substr(0,2)?t:function(e){switch(function(e){const t=e.split(":");return 3===t.length?"Bytes20MappingWithGrouping":2===t.length?"0x"===t[1].substr(0,2)?"Bytes20Mapping":"Mapping":"[]"===e.substring(e.length-2,e.length)?"Array":"Singleton"}(e)){case"Bytes20MappingWithGrouping":{const t=e.split(":");return(0,s.keccak256)(t[0]).substr(0,10)+"00000000"+(0,s.keccak256)(t[1]).substr(2,4)+"0000"+t[2].substr(0,40)}case"Bytes20Mapping":{const t=e.split(":");return(0,s.keccak256)(t[0]).substr(0,18)+"00000000"+t[1].substr(2,40)}case"Mapping":{const t=e.split(":");return(0,s.keccak256)(t[0]).substr(0,34)+"000000000000000000000000"+(0,s.keccak256)(t[1]).substr(2,8)}case"Array":case"Singleton":default:return(0,s.keccak256)(e)}}(t),n=e.find((e=>e.key===r));if(!n)throw new Error('No matching schema found for key: "'+t+'" ('+r+").");return n}function U(e,t){switch(e.keyType.toLowerCase()){case"array":{if(!Array.isArray(t))return console.error("Can't encode a non array for key of type array"),null;const r=[];for(let n=0;n<t.length;n++){const o=t[n];0===n&&r.push({key:e.key,value:L("Number","uint256",t.length.toString(),e.name)}),r.push({key:G(e.key,n),value:L(e.valueContent,e.valueType,o,e.name)})}return r}case"bytes20mapping":case"bytes20mappingwithgrouping":case"singleton":case"mapping":return L(e.valueContent,e.valueType,t,e.name);default:return console.error('Incorrect data match or keyType in schema from encodeKey(): "'+e.keyType+'"'),null}}function F(e,t,r,n){if(!D[e]&&"0x"!==e.substr(0,2))throw new Error('The valueContent "'+e+'" for "'+n+'" is not supported.');let o=D[e]&&D[e].type===t.split("[]")[0];const i="[]"===t.substr(t.length-2);if("bytes"===t||"string"===t||(0,s.isAddress)(r)||(r=function(e,t){if(!O[e])throw new Error('Could not decode valueType: "'+e+'".');return"0x"===t?null:t?O[e].decode(t):t}(t,r)),o&&(0,s.isAddress)(r)&&!(0,s.checkAddressChecksum)(r)&&(o=!o),o&&"string"!==t)return r;if(i&&Array.isArray(r)){const t=[];for(let n=0;n<r.length;n++){const o=r[n];t.push(N(e,o))}return t}return N(e,r)}function I(e,t){switch(e.keyType.toLowerCase()){case"array":{const r=[];if(!t||"string"===typeof t)return r;const n=t.find((t=>t.key===e.key));if(!n)return r;const o=F("Number","uint256",n.value,e.name)||0;for(let s=0;s<o;s++){const n=t.find((t=>t.key===G(e.key,s)));n&&r.push(F(e.valueContent,e.valueType,n.value,e.name))}return r}case"bytes20mapping":case"bytes20mappingwithgrouping":case"singleton":case"mapping":if(Array.isArray(t)){const r=t.find((t=>t.key===e.key));return r?F(e.valueContent,e.valueType,r.value,e.name):null}return F(e.valueContent,e.valueType,t,e.name);default:return console.error('Incorrect data match or keyType in schema from decodeKey(): "'+e.keyType+'"'),null}}function B(e,t){return Object.entries(e).reduce(((e,[r,n])=>{const o=K(t,r);return Object.assign(Object.assign({},e),{[o.name]:I(o,n)})}),{})}function j(e){const t=E[e];if(!t)throw new Error(`Chosen hashFunction '${e}' is not supported.\n      Supported hashFunctions: ${f}\n      `);return t}function $(e,t){return j(t).method(e)}var M=function(e,t,r,n){return new(r||(r=Promise))((function(o,s){function i(e){try{c(n.next(e))}catch(t){s(t)}}function a(e){try{c(n.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}c((n=n.apply(e,t||[])).next())}))};class V{constructor(e,t,r,n){if(!e)throw new Error("Missing schema.");this.options={schema:e,address:t,provider:this.initializeProvider(r),config:Object.assign(Object.assign({},{ipfsGateway:"https://cloudflare-ipfs.com/ipfs/"}),n)}}initializeProvider(e){if(e){if("function"===typeof e.request)return new x(e);if(!e.request&&"function"===typeof e.send)return new w(e);if("GRAPH_QL"===e.type)return e;throw new Error(`Incorrect or unsupported provider ${e}`)}}getData(e){return M(this,void 0,void 0,(function*(){return this.getAddressAndProvider(),e||(e=this.options.schema.map((e=>e.name))),Array.isArray(e)?this.getDataMultiple(e):this.getDataSingle(e)}))}fetchData(e){return M(this,void 0,void 0,(function*(){const t=yield this.getData(e),r=yield this.getDataFromExternalSources(t);return Object.assign(Object.assign({},t),r)}))}getDataFromExternalSources(e){return Object.entries(e).filter((([e])=>{const t=K(this.options.schema,e);return["jsonurl","asseturl"].includes(t.valueContent.toLowerCase())})).reduce(((e,[t,r])=>M(this,void 0,void 0,(function*(){let n;try{const{url:e}=this.patchIPFSUrlsIfApplicable(r);n=yield fetch(e).then((e=>M(this,void 0,void 0,(function*(){return r.hashFunction===h.KECCAK256_BYTES?e.arrayBuffer().then((e=>new Uint8Array(e))):e.json()}))))}catch(o){throw console.error(o,`GET request to ${r.url} failed`),o}return e[t]=function(e,t,r){const n=$(e,r);return n===t||(console.error(`Hash mismatch, returned JSON hash ("${n}") is different from expected hash "${t}"`),!1)}(n,r.hash,r.hashFunction)?n:null,e}))),{})}encodeData(e){return function(e,t){return Object.entries(e).reduce(((e,[r,n])=>{const o=K(t,r);return e[r]={value:U(o,n),key:o.key},e}),{})}(e,this.options.schema)}decodeData(e){return B(e,this.options.schema)}getOwner(e){return M(this,void 0,void 0,(function*(){const{address:t,provider:r}=this.getAddressAndProvider();return r.getOwner(e||t)}))}getArrayValues(e,t){var r,n;return M(this,void 0,void 0,(function*(){if("Array"!==e.keyType)throw new Error(`The "getArrayValues" method requires a schema definition with "keyType: Array",\n         ${e}`);const o=[],s=t[e.key];if(!s||!s.value)return o;const i=yield F("Number","uint256",s.value,e.name),a=[];for(let r=0;r<i;r++){const n=G(e.key,r);t[n]||a.push(n)}if("GRAPH_QL"!==this.options.provider.type){try{const e=yield null===(r=this.options.provider)||void 0===r?void 0:r.getAllData(this.options.address,a);o.push(...e)}catch(c){}return o}for(let e=0;e<a.length;e++){const t=yield null===(n=this.options.provider)||void 0===n?void 0:n.getData(this.options.address,a[e]);o.push({key:a[e],value:t})}return o}))}getDataSingle(e){var t;return M(this,void 0,void 0,(function*(){const r=K(this.options.schema,e),n=yield null===(t=this.options.provider)||void 0===t?void 0:t.getData(this.options.address,r.key);if("array"===r.keyType.toLowerCase()){const e={[r.key]:{key:r.key,value:n}},t=yield this.getArrayValues(r,e);return t&&t.length>0?(t.push(e[r.key]),{[r.name]:I(r,t)}):{[r.name]:[]}}return{[r.name]:I(r,n)}}))}getDataMultiple(e){var t,r;return M(this,void 0,void 0,(function*(){const n=e.map((e=>K(this.options.schema,e).key)),o=yield null===(t=this.options.provider)||void 0===t?void 0:t.getAllData(this.options.address,n);if("GRAPH_QL"===(null===(r=this.options.provider)||void 0===r?void 0:r.type))return o.reduce(((e,t)=>(e[t.key]=t.value,e)),{});const s=o.reduce(((e,t)=>(e[t.key]=t.value,e)),{}),i=this.options.schema.filter((e=>"array"===e.keyType.toLowerCase()));for(const e of i){const t={[e.key]:{key:e.key,value:s[e.key]}},r=yield this.getArrayValues(e,t);r&&r.length>0&&(r.push(t[e.key]),s[e.key]=r)}return B(s,this.options.schema)}))}patchIPFSUrlsIfApplicable(e){return e&&e.url&&-1!==e.url.indexOf("ipfs://")?Object.assign(Object.assign({},e),{url:e.url.replace("ipfs://",this.options.config.ipfsGateway)}):e}getAddressAndProvider(){if(!(0,s.isAddress)(this.options.address))throw new Error("Missing ERC725 contract address.");if(!this.options.provider)throw new Error("Missing provider.");return{address:this.options.address,provider:this.options.provider}}}}}]);